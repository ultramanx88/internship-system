<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test localStorage</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { background-color: #d4edda; border-left: 4px solid #28a745; }
        .error { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background-color: #d1ecf1; border-left: 4px solid #17a2b8; }
        button { padding: 12px 24px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Test localStorage</h1>
        
        <div class="section info">
            <h3>1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage</h3>
            <button onclick="checkLocalStorage()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage</button>
            <div id="result1"></div>
        </div>

        <div class="section info">
            <h3>2. ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
            <button onclick="loginAndStore()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤)</button>
            <div id="result2"></div>
        </div>

        <div class="section info">
            <h3>3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage ‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <button onclick="checkAfterLogin()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            <div id="result3"></div>
        </div>
    </div>

    <script>
        function checkLocalStorage() {
            const resultDiv = document.getElementById('result1');
            
            try {
                const allKeys = Object.keys(localStorage);
                const storedUser = localStorage.getItem('internship-flow-user');
                const storedVersion = localStorage.getItem('internship-flow-version');
                
                resultDiv.innerHTML = `
                    <div class="${storedUser ? 'success' : 'error'}">
                        <h4>${storedUser ? '‚úÖ' : '‚ùå'} localStorage Status</h4>
                        <p><strong>All Keys:</strong> ${allKeys.join(', ')}</p>
                        <p><strong>internship-flow-user:</strong> ${storedUser ? 'Found' : 'Not found'}</p>
                        <p><strong>internship-flow-version:</strong> ${storedVersion || 'Not found'}</p>
                        ${storedUser ? `<pre>${JSON.stringify(JSON.parse(storedUser), null, 2)}</pre>` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        async function loginAndStore() {
            const resultDiv = document.getElementById('result2');
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        identifier: 't6800007@smart-solutions.com',
                        role: '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤',
                        password: '123456'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
                    localStorage.setItem('internship-flow-user', JSON.stringify(data.user));
                    localStorage.setItem('internship-flow-version', '1.0');
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h4>
                            <p><strong>User ID:</strong> ${data.user.id}</p>
                            <p><strong>Name:</strong> ${data.user.name}</p>
                            <p><strong>Email:</strong> ${data.user.email}</p>
                            <p><strong>Roles:</strong> ${data.user.roles.join(', ')}</p>
                            <p><strong>Data stored in localStorage:</strong> ‚úÖ</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</h4>
                            <p>Status: ${response.status}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Network Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        function checkAfterLogin() {
            const resultDiv = document.getElementById('result3');
            
            try {
                const allKeys = Object.keys(localStorage);
                const storedUser = localStorage.getItem('internship-flow-user');
                const storedVersion = localStorage.getItem('internship-flow-version');
                
                if (storedUser) {
                    const parsedUser = JSON.parse(storedUser);
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>‚úÖ localStorage ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß!</h4>
                            <p><strong>All Keys:</strong> ${allKeys.join(', ')}</p>
                            <p><strong>User ID:</strong> ${parsedUser.id}</p>
                            <p><strong>Name:</strong> ${parsedUser.name}</p>
                            <p><strong>Email:</strong> ${parsedUser.email}</p>
                            <p><strong>Roles:</strong> ${parsedUser.roles.join(', ')}</p>
                            <p><strong>Educator Role:</strong> ${parsedUser.educatorRole ? parsedUser.educatorRole.name : 'Not set'}</p>
                            <pre>${JSON.stringify(parsedUser, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="error">
                            <h4>‚ùå ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage</h4>
                            <p><strong>All Keys:</strong> ${allKeys.join(', ')}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        <h4>‚ùå Error</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // Auto-check on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkLocalStorage();
            }, 500);
        });
    </script>
</body>
</html>
