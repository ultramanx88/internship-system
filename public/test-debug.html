<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Test - HTTP</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .debug-section { margin: 20px 0; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { background-color: #d4edda; border-left: 4px solid #28a745; }
        .error { background-color: #f8d7da; border-left: 4px solid #dc3545; }
        .info { background-color: #d1ecf1; border-left: 4px solid #17a2b8; }
        button { padding: 12px 24px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 4px; border: 1px solid #dee2e6; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        .status { display: inline-block; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Test - HTTP Version</h1>
        <p><strong>URL:</strong> <span id="currentUrl"></span></p>
        
        <div class="debug-section info">
            <h3>1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage</h3>
            <button onclick="checkLocalStorage()">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö localStorage</button>
            <div id="localStorageResult" class="result" style="display: none;"></div>
        </div>

        <div class="debug-section info">
            <h3>2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <button onclick="testLogin()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö (‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤)</button>
            <div id="loginResult" class="result" style="display: none;"></div>
        </div>

        <div class="debug-section info">
            <h3>3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Educator</h3>
            <button onclick="testEducator()">‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Educator</button>
            <div id="educatorResult" class="result" style="display: none;"></div>
        </div>

        <div class="debug-section">
            <h3>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö</h3>
            <div id="summaryResult" class="result">
                <p>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</p>
            </div>
        </div>
    </div>

    <script>
        let debugResults = {};

        // ‡πÅ‡∏™‡∏î‡∏á URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
        document.getElementById('currentUrl').textContent = window.location.href;

        function checkLocalStorage() {
            const resultDiv = document.getElementById('localStorageResult');
            resultDiv.style.display = 'block';
            
            try {
                const storedUser = localStorage.getItem('internship-flow-user');
                const storedVersion = localStorage.getItem('internship-flow-version');
                const allKeys = Object.keys(localStorage);
                
                debugResults.localStorage = {
                    status: storedUser ? 'success' : 'error',
                    message: storedUser ? '‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô localStorage' : '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô localStorage',
                    details: {
                        storedUser: storedUser ? JSON.parse(storedUser) : null,
                        storedVersion: storedVersion,
                        allKeys: allKeys
                    }
                };
                
                resultDiv.innerHTML = `
                    <div class="${debugResults.localStorage.status === 'success' ? 'success' : 'error'}">
                        <strong>${debugResults.localStorage.status === 'success' ? '‚úÖ' : '‚ùå'} ${debugResults.localStorage.message}</strong><br>
                        <br><strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><br>
                        <pre>${JSON.stringify(debugResults.localStorage.details, null, 2)}</pre>
                    </div>
                `;
            } catch (error) {
                debugResults.localStorage = {
                    status: 'error',
                    message: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô localStorage',
                    details: { error: error.message }
                };
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:</strong><br>
                        ${error.message}
                    </div>
                `;
            }
            
            updateSummary();
        }

        async function testLogin() {
            const resultDiv = document.getElementById('loginResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            
            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        identifier: 't6800007@smart-solutions.com',
                        role: '‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏¥‡∏ä‡∏≤',
                        password: '123456'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    debugResults.login = {
                        status: 'success',
                        message: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
                        details: data
                    };
                    
                    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
                    localStorage.setItem('internship-flow-user', JSON.stringify(data.user));
                    localStorage.setItem('internship-flow-version', '1.0');
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</strong><br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    debugResults.login = {
                        status: 'error',
                        message: `HTTP ${response.status}: ${data.message || 'Unknown error'}`,
                        details: data
                    };
                    
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:</strong><br>
                            Status: ${response.status}<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                debugResults.login = {
                    status: 'error',
                    message: `Network Error: ${error.message}`,
                    details: { error: error.message, type: error.name }
                };
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}<br>
                        <br><strong>Error Type:</strong> ${error.name}
                    </div>
                `;
            }
            
            updateSummary();
        }

        async function testEducator() {
            const resultDiv = document.getElementById('educatorResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö...';
            
            try {
                const response = await fetch('/educator');
                const html = await response.text();
                
                if (response.ok) {
                    const checks = {
                        hasLoadingState: html.includes('animate-spin'),
                        hasErrorState: html.includes('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'),
                        hasUserData: html.includes('‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå'),
                        hasDashboard: html.includes('‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å'),
                        hasSchedule: html.includes('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á'),
                        hasTimeline: html.includes('‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏´‡∏Å‡∏¥‡∏à‡∏®‡∏∂‡∏Å‡∏©‡∏≤'),
                        hasPieChart: html.includes('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏á‡∏≤‡∏ô'),
                        hasNotifications: html.includes('‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô'),
                        hasMyTasks: html.includes('‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô'),
                        hasTable: html.includes('‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠')
                    };
                    
                    const passedChecks = Object.values(checks).filter(Boolean).length;
                    const totalChecks = Object.keys(checks).length;
                    
                    debugResults.educator = {
                        status: 'success',
                        message: `‡∏´‡∏ô‡πâ‡∏≤ Educator ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ (${passedChecks}/${totalChecks} ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)`,
                        details: { checks, htmlLength: html.length }
                    };
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ ‡∏´‡∏ô‡πâ‡∏≤ Educator ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ!</strong><br>
                            <br><strong>‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:</strong><br>
                            ${Object.entries(checks).map(([key, value]) => 
                                `‚Ä¢ ${key}: <span class="status ${value ? 'success' : 'error'}">${value ? '‚úÖ' : '‚ùå'}</span>`
                            ).join('<br>')}
                            <br><br><strong>HTML Length:</strong> ${html.length} characters
                        </div>
                    `;
                } else {
                    debugResults.educator = {
                        status: 'error',
                        message: `HTTP ${response.status}`,
                        details: { status: response.status, response: html.substring(0, 500) }
                    };
                    
                    resultDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ Educator:</strong><br>
                            Status: ${response.status}<br>
                            <pre>${html.substring(0, 500)}...</pre>
                        </div>
                    `;
                }
            } catch (error) {
                debugResults.educator = {
                    status: 'error',
                    message: `Network Error: ${error.message}`,
                    details: { error: error.message, type: error.name }
                };
                
                resultDiv.innerHTML = `
                    <div class="error">
                        <strong>‚ùå Network Error:</strong><br>
                        ${error.message}<br>
                        <br><strong>Error Type:</strong> ${error.name}
                    </div>
                `;
            }
            
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summaryResult');
            const results = Object.values(debugResults);
            
            if (results.length === 0) {
                summaryDiv.innerHTML = '<p>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö...</p>';
                return;
            }
            
            const successCount = results.filter(r => r.status === 'success').length;
            const errorCount = results.filter(r => r.status === 'error').length;
            
            const overallStatus = errorCount === 0 ? 'success' : 'error';
            const statusIcon = overallStatus === 'success' ? '‚úÖ' : '‚ùå';
            const statusText = overallStatus === 'success' ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : '‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤';
            
            summaryDiv.innerHTML = `
                <div class="${overallStatus}">
                    <h4>${statusIcon} ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ${statusText}</h4>
                    <p><strong>‡∏ú‡∏•‡∏£‡∏ß‡∏°:</strong> ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount}, ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${errorCount}</p>
                    <br>
                    <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î:</strong><br>
                    ${results.map((result, index) => 
                        `‚Ä¢ ${Object.keys(debugResults)[index]}: <span class="status ${result.status}">${result.message}</span>`
                    ).join('<br>')}
                </div>
            `;
        }

        // Auto-run checks on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkLocalStorage();
            }, 500);
        });
    </script>
</body>
</html>
